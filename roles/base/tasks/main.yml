  - name: create groups
    group:
      name: "{{ item }}" 
    with_items: base_groups

  - name: create accounts
    user:
      name: "{{ item.name }}" 
      comment: "{{ item.comment }}" 
      uid: "{{ item.uid }}" 
      groups: "{{ item.groups }}"
      shell: "/bin/bash"
    with_items: user_info

  - name: set up keys
    authorized_key:
      exclusive: true
      user: "{{ item.name }}"
      key: "{{ item.key }}"
    with_items: user_info

  - name: "install {{ item }}"
    apt: 
      pkg: "{{ item }}" 
      state: latest
    with_items: base_packages

  - name: update sudoers
    copy:
      src: sudoers
      dest: /etc/sudoers
      owner: root
      group: root
      mode: 0400
    
